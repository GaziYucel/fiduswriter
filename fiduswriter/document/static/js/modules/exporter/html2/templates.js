import {noSpaceTmp, escapeText} from "../../common"

/** A template for HTML export of a document. */
export const htmlExportTemplate = ({head, body, back, settings, styleSheets, title, lang, xhtml}) =>
    `${
        xhtml ?
            '<?xml version="1.0" encoding="UTF-8"?>' :
            '<!DOCTYPE html>'
    }
    <html lang="${lang}"${xhtml ? ` xmlns="http://www.w3.org/1999/xhtml" xml:lang="${lang}"` : ''}>
        <meta charset="UTF-8">
        ${settings.copyright && settings.copyright.holder ? `<meta name="copyright" content="© ${settings.copyright.year ? settings.copyright.year : new Date().getFullYear()} ${escapeText(settings.copyright.holder)}" />` : ''}
        <title>${escapeText(title)}</title>
        ${head}
${
    styleSheets.map(
        sheet => sheet.filename ?
            `<link rel="stylesheet" type="text/css" href="${sheet.filename}" />` :
            `<style>${sheet.contents}</style>`
    ).join('')
}
    </head>
    <body class="article">
        ${body}
        ${back}
        ${
    settings.copyright && settings.copyright.holder ?
        `<div>© ${settings.copyright.year ? settings.copyright.year : new Date().getFullYear()} ${settings.copyright.holder}</div>` :
        ''
}
        ${
    settings.copyright && settings.copyright.licenses.length ?
        `<div>${settings.copyright.licenses.map(license => `<a rel="license" href="${escapeText(license.url)}">${escapeText(license.title)}${license.start ? ` (${license.start})` : ''}</a>`).join('</div><div>')}</div>` :
        ''
}
    </body>
</html>`

export const darManifest = ({images, title}) =>
    '<?xml version="1.0" encoding="UTF-8"?>\n' +
noSpaceTmp`<!DOCTYPE manifest PUBLIC "DarManifest 0.1.0" "http://darformat.org/DarManifest-0.1.0.dtd">
<dar>
    <!-- Generated by Fidus Writer -->
    <documents>
        <document id="manuscript" name="${escapeText(title)}" type="article" path="manuscript.xml" />
    </documents>
    <assets>${
    images.map(image => `<asset id="${image.filename.split(".")[0]}" mime-type="image/${
        image.filename.split(".")[1] === "png" ?
            'png' :
            image.filename.split(".")[1] === "svg" ?
                'svg+xml' :
                'jpeg'
    }" name="${image.title}" path="${image.filename}"/>`).join('')
}</assets>
</dar>`
